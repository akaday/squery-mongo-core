<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.66">
<title data-react-helmet="true">  | cMQL</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_language" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="  | cMQL"><meta data-react-helmet="true" name="description" content="What is cMQL"><meta data-react-helmet="true" property="og:description" content="What is cMQL"><meta data-react-helmet="true" property="og:url" content="https://tkaryadis.github.io/cmql-core/docs/"><link data-react-helmet="true" rel="shortcut icon" href="/cmql-core/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://tkaryadis.github.io/cmql-core/docs/"><link rel="stylesheet" href="/cmql-core/styles.495a138b.css">
<link rel="preload" href="/cmql-core/styles.feaccdac.js" as="script">
<link rel="preload" href="/cmql-core/runtime~main.d60d5b06.js" as="script">
<link rel="preload" href="/cmql-core/main.2edf4c6f.js" as="script">
<link rel="preload" href="/cmql-core/1.0eaafbb4.js" as="script">
<link rel="preload" href="/cmql-core/2.086bcdde.js" as="script">
<link rel="preload" href="/cmql-core/52.fe66fd41.js" as="script">
<link rel="preload" href="/cmql-core/53.91d632f3.js" as="script">
<link rel="preload" href="/cmql-core/935f2afb.7c2f70d3.js" as="script">
<link rel="preload" href="/cmql-core/17896441.d6ed6c30.js" as="script">
<link rel="preload" href="/cmql-core/b9d06000.39d8f44e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/cmql-core/"><img class="navbar__logo" src="/cmql-core/img/logo.png" alt="cMQL"><strong class="navbar__title">cMQL</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cmql-core/docs/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/cmql-core/"><img class="navbar__logo" src="/cmql-core/img/logo.png" alt="cMQL"><strong class="navbar__title">cMQL</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/cmql-core/docs/">Docs</a></li><li class="menu__list-item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Intro</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cmql-core/docs/intro/guide">Documentation guide</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/cmql-core/docs/">What is cMQL?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cmql-core/docs/intro/why">Why cMQL?</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">cMQL</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cmql-core/docs/cMQL/intro">Intro</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cmql-core/docs/cMQL/notation">Notation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cmql-core/docs/cMQL/operators">Operators</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cmql-core/docs/cMQL/stages">Stages</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cmql-core/docs/cMQL/arguments">Arguments</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cmql-core/docs/cMQL/commands">Commands and Methods</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Generate MQL</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cmql-core/docs/cmqltool/generatemql">cMQL as Tool</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">cMQL Apps</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cmql-core/docs/cqmlapp/intro">Intro</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cmql-core/docs/cmqlapp/javaapp">Java</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cmql-core/docs/cmqlapp/clojureapp">Clojure</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cmql-core/docs/cmqlapp/nodejsapp">Nodejs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cmql-core/docs/cmqlapp/clojurescriptapp">Clojurescript</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cmql-core/docs/api/cmql-j">cmql-j</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cmql-core/docs/api/cmql-js">cmql-js</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Server side</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cmql-core/docs/javascript-clojurescript/javascript">Server side javascript</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cmql-core/docs/javascript-clojurescript/functions">Server side functions</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Encode-Decode</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cmql-core/docs/encodedecode/intro">Intro</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cmql-core/docs/encodedecode/cmql-j">cMQL-j</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Extras</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cmql-core/docs/extras/intro">Intro</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cmql-core/docs/extras/arrays">Arrays</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cmql-core/docs/extras/groups">Groups</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cmql-core/docs/extras/nested">Nested</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Contribute</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cmql-core/docs/development/contribute">Future goals</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw"> </h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="what-is-cmql"></a>What is cMQL<a aria-hidden="true" tabindex="-1" class="hash-link" href="#what-is-cmql" title="Direct link to heading">#</a></h2><ul><li>query and data processing language for MongoDB  </li><li>generates MQL that can be used as standalone commands, or as arguments in driver methods</li><li>main characteristics<ul><li>up to <strong>3x</strong> less code</li><li>simple structure of code</li><li>simple notation</li></ul></li><li>() for code , {} for data<br>like MQL with () <a href="/cmql-core/docs/intro/why">see also</a>      </li><li>portable queries in both cmql-js and cmql-java      </li><li>with the same perfomance          </li></ul><p>cMQL in order to archive the above goals, is made with Clojure<br>
It can be used as a tool to generate MQL or to call cMQL code directly.    </p><p><a href="http://localhost:3000/docs/intro/guide" target="_blank" rel="noopener noreferrer">Learning guide</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="examples"></a>Examples<a aria-hidden="true" tabindex="-1" class="hash-link" href="#examples" title="Direct link to heading">#</a></h2><p>The easiest way to start is to use it online at <a href="/cmql-core/docs/www.cmql-live.org">cMQL-live</a><br>
It has &gt; 100 examples, type on search box the MQL operator that you want to search for, and results will appear sorted by query size.  </p><p>StackOverflow was used to create the examples, to see the question press on the <strong>ExLink</strong>  </p><p>cMQL-live is an online cMQL to MQL generator, providing a subset of cMQL (2 commands aggregate/update)
Bellow is 4 examples just to show how cMQL looks like.   </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="example1"></a>Example1<a aria-hidden="true" tabindex="-1" class="hash-link" href="#example1" title="Direct link to heading">#</a></h3><div><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_1w39 tabs__item--active" style="outline:none">cMQL</li><li role="tab" tabindex="0" aria-selected="false" class="tabs__item tabItem_1w39" style="outline:none">MQL</li></ul><div role="tabpanel" class="margin-vert--md"><div><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-text codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">(q (= :bedrooms 1)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   (= :country.code &quot;GR&quot;)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   (group {:_id :stars}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          {:average-price (avg :price)})</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   (sort :average-price)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   (limit 1))</span></div></div></div></div></div></div></div></div><p><strong>cMQL improvements</strong></p><ul><li>used common operators names for example <code>=</code> not <code>&quot;$eq&quot;</code></li><li>replaced <code>{}</code> with <code>()</code> for code</li><li>simpler notation <code>:field</code> for references, instead of <code>$ &quot;&quot;</code> </li><li>less verbose</li><li>auto-add stages like match</li></ul><p>Result is more clear code, clear structure, significant less code.<br>
(<strong>95</strong> less non-whitespace characters and ~<strong>2x</strong> less code)</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="example2"></a>Example2<a aria-hidden="true" tabindex="-1" class="hash-link" href="#example2" title="Direct link to heading">#</a></h3><div><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_1w39 tabs__item--active" style="outline:none">cMQL</li><li role="tab" tabindex="0" aria-selected="false" class="tabs__item tabItem_1w39" style="outline:none">MQL</li></ul><div role="tabpanel" class="margin-vert--md"><div><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-text codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">(q :people.workers</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   (&lt; :salary 1000)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   (&gt; :years 1)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   {:children (filter (fn [:child.] (&lt; :child.age. 15)) :all-children)}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   (&gt;= :children 2)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   {:bonus (reduce (fn [:total. :child.]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                     (cond (&lt; :child.age. 5) (+ :total. 100)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                           (&lt; :child.age. 10) (+ :total. 50)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                           :else (+ :total. 20)))</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                   0</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                   :children)}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   [:!id :name {:new-salary (+ :salary (if- (&gt; :bonus 200) 200 :bonus))}]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   (sort :!new-salary))</span></div></div></div></div></div></div></div></div><p><strong>cMQL improvements</strong></p><ul><li>the ones that are noted the previous example including</li><li>auto added those common used stages<ul><li><code>()</code> -&gt; for filters </li><li><code>{}</code> -&gt; for addFields</li><li><code>[]</code> -&gt; for project </li></ul></li><li>mql variable notation   <ul><li><code>:child. = $$child</code> </li><li><code>:child.age.=&quot;$$child.age&quot;</code></li></ul></li><li>sort and project simpler with <code>!</code> for the opposite value  </li><li>filter/map/reduce minimalistic with simple programming structure  <div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-text codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">(filter (fn [:child.] ...) :all-children)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">(reduce (fn [:total. :child.] ...) :children)</span></div></div></div></div></div>Alternative if we didn&#x27;t want to use extra variables and <code>$let</code> in reduce<div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">(filter (fn [:this.] ...) :all-children)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">(reduce (fn [:value. :this.] ...) :children)</span></div></div></div></div></div></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="example-3"></a>Example 3<a aria-hidden="true" tabindex="-1" class="hash-link" href="#example-3" title="Direct link to heading">#</a></h3><p>cMQL is about less code, simple notation, good structure.<br>
Here ~<strong>3x</strong> less code, 208 characters less, with simpler notation.</p><p>But here the most important is the structure.
cMQL makes big and complicated queries easy to read and write.</p><div><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_1w39 tabs__item--active" style="outline:none">cMQL</li><li role="tab" tabindex="0" aria-selected="false" class="tabs__item tabItem_1w39" style="outline:none">MQL</li></ul><div role="tabpanel" class="margin-vert--md"><div><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-text codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">(q {:s </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    (let [:a. (reduce (fn [:sum. :n.] (+ :sum. :n.))</span></div><div class="token-line" style="color:#393A34"><span class="token plain">              0</span></div><div class="token-line" style="color:#393A34"><span class="token plain">              (filter (fn [:w.] (some? :w.))</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                      (map (fn [:v.] (+ :v. 1)) :myarray)))]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">         :a.)})</span></div></div></div></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="example-4"></a>Example 4<a aria-hidden="true" tabindex="-1" class="hash-link" href="#example-4" title="Direct link to heading">#</a></h3><p>Overview query of many aggregate operators. </p><p>The difference is clear, in all levels</p><ul><li>size of code (+1330 more characters)</li><li>lines of code (+ 60 more lines)</li><li>notation</li><li>structure</li></ul><div><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_1w39 tabs__item--active" style="outline:none">cMQL</li><li role="tab" tabindex="0" aria-selected="false" class="tabs__item tabItem_1w39" style="outline:none">MQL</li></ul><div role="tabpanel" class="margin-vert--md"><div><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-text codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">(q (= :a (div (* :b (pow 20 2)) 10))</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   (= :b (not (or (&lt; :a 1) (&gt; :a 2))))</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   (= :c (trim (upper-case (subs :f 0 5))))</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   (= :d (count-str (str &quot;a&quot; :c &quot;c&quot;)))</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   (or (exists? :c) (string? :d) (array? :b) (object? :c) (long? :d))</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   {</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    :a (map (fn [:v.] (+ :v. 1)) :myarray)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    :b (filter (fn [:w.] (some? :w.)) :myarray)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    :c (reduce (fn [:sum. :n.] (+ :sum. :n.)) 0 :myarray)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    :d (concat :myarray (conj :myarray 10) (take 2 10 :myarray))</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    :e (get (take 10 (reverse (ziparray :x :y :z))) 2)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    :f (contains? (difference (union :x :y (intersection :w :z)) [1 2 3]) 4)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    :g (all-true? :z)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    :h (empty? :z)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    }</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    [</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    {:j (let [:a. 1</span></div><div class="token-line" style="color:#393A34"><span class="token plain">              :v. (+ :a. 1)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">              :x. (+ :v. 2)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">              :z. (+ :v. :x.)]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">         (cond (= :v. 10) 20</span></div><div class="token-line" style="color:#393A34"><span class="token plain">               (= :v. 20) 30</span></div><div class="token-line" style="color:#393A34"><span class="token plain">              :else 0))}</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    {:k (if- (contains? :myarray 10)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">         (take 0 10 (conj-distinct :myarray 10))</span></div><div class="token-line" style="color:#393A34"><span class="token plain">         (get :myarray 5))}</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    {:l (let [:a. (reduce (fn [:sum. :n.] (+ :sum. :n.))</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                          0</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                         (filter (fn [:w.] (some? :w.))</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                                   (map (fn [:v.] (+ :v. 1)) :myarray)))</span></div><div class="token-line" style="color:#393A34"><span class="token plain">              :b. (let [:c. (into {} (ziparray (range 20) :myarray))]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                    (into [] (merge :c. :a.)))]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">         (concat :a. :b.))}])</span></div></div></div></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cmql-as-tool-to-generate-mql"></a>cMQL as tool to generate MQL<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cmql-as-tool-to-generate-mql" title="Direct link to heading">#</a></h2><p>This method uses the JSON portabillity,and it can be used from any driver language,<br>
and without knowing any clojure.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="manual"></a>Manual<a aria-hidden="true" tabindex="-1" class="hash-link" href="#manual" title="Direct link to heading">#</a></h3><p>Easy to use with languages that support JSON like literals like js/python etc</p><ul><li><a href="/cmql-core/docs/www.cmql-live.org">cMQL-live</a> write cMQL
(or make a small cMQL app just to generate MQL)</li><li>get the generated MQL, make small changes or add driver variables</li><li>add the MQL in code  </li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="auto"></a>Auto<a aria-hidden="true" tabindex="-1" class="hash-link" href="#auto" title="Direct link to heading">#</a></h3><p>The above can be automated and expanded to languages like Java/Go etc that don&#x27;t support JSON like literals.  </p><ul><li>cMQL can become MQL, driver variables can have a symbolic notation for example <code>&quot;$$$myvar&quot;</code></li><li>MQL JSON can become an Document (with parse)</li><li>variables can be added to the Document object, from a hash-map that have <code>{myvar : value}</code> dynamically </li></ul><p>The cost is practical zero(queries are so small data-structures), and it only requires simple code to auto-mate it.
This method is the way to use MQL instead of driver query builders.</p><p>For more information and example on how to use cMQL as tool see also <a href="/cmql-core/docs/cmqltool/cmqltool">here</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cmql-as-api"></a>cMQL as API<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cmql-as-api" title="Direct link to heading">#</a></h2><p>JSON portabillity allowed us to use MQL in many drivers, but Clojure portabillity allows as to call cMQL directly.   </p><p>cMQL code can be called directly from the bellow languages (without generating MQL), and its simple like a normal function call         </p><ul><li>Java</li><li>Javascript</li><li>Clojure</li><li>Clojurescript </li></ul><p>Clojure is made to be a <a href="/cmql-core/docs/#easy-to-use-from-drivers">hosted language</a> and using cMQL from Java or Nodejs app is like a normal function call.</p><p>This way we don&#x27;t need to generate MQL, we call cMQL directly, and we can choose how much clojure/cMQL to used.<br>
We can use cMQL only for queries or add application logic also, or even make all the application in 1 language clojure/cmql</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="java-programmers"></a>Java programmers<a aria-hidden="true" tabindex="-1" class="hash-link" href="#java-programmers" title="Direct link to heading">#</a></h3><p>Calling cMQL from Java is like a normal static java function<br>
Getting the benefits of cMQL to write data as json literals and queries easily<br>
cMQL is functional and suitable for data processing and querying.<br>
cMQL can be called like a normal static java function.</p><p>Java programmers use cMQL-j.<br>
See also <a href="/cmql-core/docs/intro/why">Why cMQL</a> and <a href="/cmql-core/docs/cMQL-j/javaapp">Why cMQL for Java?</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="node-programmers"></a>Node programmers<a aria-hidden="true" tabindex="-1" class="hash-link" href="#node-programmers" title="Direct link to heading">#</a></h3><p>Calling cMQL from js is like a normal static java function<br>
cMQL is functional and suitable for data processing and querying.<br>
cMQL can be called like a normal js function.</p><p>Node programmers use cMQL-js
See also <a href="/cmql-core/docs/intro/why">Why cMQL</a> and <a href="/cmql-core/docs/cMQL-jS/nodejsapp">Why cMQL for Javascript?</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="clojure-programmers"></a>Clojure programmers<a aria-hidden="true" tabindex="-1" class="hash-link" href="#clojure-programmers" title="Direct link to heading">#</a></h3><p>cMQL is like Clojure.<br>
It feels like querying MongoDB in Clojure.<br>
If someone knows Clojure almost knows cMQL already.   </p><p>cMQL is fast because we can encode to BSON directly from Clojure,or decode directly
from BSON.Perfomance is like native Java driver,even if we write or read clojure data.  </p><p>Clojure programmers use cMQL-j and the Java driver.<br>
See also <a href="/cmql-core/docs/intro/why">Why cMQL</a> and <a href="/cmql-core/docs/cMQL-j/clojureapp">Why cMQL for Clojure?</a>  </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="clojurescript-programmers"></a>ClojureScript programmers<a aria-hidden="true" tabindex="-1" class="hash-link" href="#clojurescript-programmers" title="Direct link to heading">#</a></h3><p>For the same reasons as Clojure programmers, described above. </p><p>ClojureScript programmers use cMQL-js and the Nodejs driver.<br>
See also <a href="/cmql-core/docs/intro/why">Why cMQL</a> and <a href="/cmql-core/docs/cMQL-js/clojurescriptapp">Why cMQL for Clojurescript?</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cmql-goals"></a>cMQL-goals<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cmql-goals" title="Direct link to heading">#</a></h2><ol><li>Be simple,readable,and much smaller   </li><li>Cover MQL    </li><li>Easy to use from drivers  </li><li>Run in many drivers,be portable  </li><li>Use the driver way  </li><li>Perfomance,encode/decode BSON directly to the target language data-structures  </li><li>Popularity</li><li>Replace javascript </li><li>Unify MongoDB developement in 1 language    </li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="simple"></a>Simple<a aria-hidden="true" tabindex="-1" class="hash-link" href="#simple" title="Direct link to heading">#</a></h3><p>cMQL main goal is to be   </p><ul><li>much smaller in code (its 2-3x for the most queries)  </li><li>clear notation     </li><li>clear structure      </li></ul><p>Syntax and notation  </p><ol><li><p>{} for data  (like MQL)</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-text codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">{</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  :firstName &quot;Louna&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  :country   &quot;Finland&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  :city      &quot;Jyvaskyla&quot;</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  :degrees   [&quot;Nurse&quot; &quot;Cardio emergencies qualified&quot;]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">}</span></div></div></div></div></div></li><li><p>() for code  (like clojure)</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-text codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">(reduce (fn [sum n] (+ sum n)) [] myarray)               ; clojure</span></div></div></div></div></div><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-text codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">(reduce (fn [:sum. :n.] (+ :sum. :n.)) [] :myarray)      ; cMQL</span></div></div></div></div></div><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-text codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">{&quot;$reduce&quot; {&quot;input&quot; &quot;$myarray&quot;,                          ; MQL</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            &quot;initialValue&quot; [],</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            &quot;in&quot; {&quot;$let&quot; {&quot;vars&quot; {&quot;sum&quot; &quot;$$value&quot;, &quot;n&quot; &quot;$$this&quot;},</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                          &quot;in&quot; {&quot;$add&quot; [&quot;$$sum&quot; &quot;$$n&quot;]}}}}}</span></div></div></div></div></div></li><li><p>Homoiconic<br>
MQL cMQL are both homoiconic,meaning that code is written in data structures of the language<br>
They both use a functional nested way of programming suitable for data processing  </p></li><li><p>Minimalistic </p><ul><li>No extra words (like about &quot;vars&quot; &quot;in&quot; etc)</li><li>No symbols like $ $$ &quot;&quot; , no capital letters etc</li></ul></li><li><p>Keywords for references and variables</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-text codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">:afield =&gt; &quot;$field&quot;   reference</span></div><div class="token-line" style="color:#393A34"><span class="token plain">:avar.  =&gt; &quot;$$avar&quot;   variable</span></div><div class="token-line" style="color:#393A34"><span class="token plain">:avar.afield.  = :.avar.afield  variable path</span></div><div class="token-line" style="color:#393A34"><span class="token plain">:REMOVE. =&gt; &quot;$$REMOVE&quot; system variable</span></div><div class="token-line" style="color:#393A34"><span class="token plain">{:afield &quot;&quot;} =&gt; {&quot;afield&quot; &quot;&quot;}  :afield on the left as key is a string</span></div></div></div></div></div></li><li><p>Use of core language names</p><p>We use =,&gt; not equal gt etc ,cMQL feels like using clojure to query MongoDB<br>
This is made possible with clojure&#x27;s powerful macros  </p><p>Inside the query we can refer to clojure with prefix like c/str.<br>
If we need to write alot of code,to avoid the prefix we can make it a function.    </p><p>For Clojure programmers this mean that they already know most part of cMQL<br>
For non Clojure programmers cMQL is easier to learn that MQL  </p></li><li><p>Queries/pipelines  </p><p> Queries are processed to allow the programmer to write minimal and intuitive code.<br>
There is no perfomance cost,because queries are so small data structures.  </p><ul><li>Auto add common used stages <ul><li>filters will become match stage  </li><li>{} is $addFields  </li><li>[] is $project , using ! to unset and {:anewfield ...} to addfield</li></ul></li><li>Sorting,Projecting notation :myfield :!myfield</li><li>nested stages becomes flatten,nil stages are removed </li></ul><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-text codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">(q :testdb.testcoll</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   (&lt; :salary 1000)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   (&gt; :workingYears 1)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   {:smallChildren (filter (fn [:child.] (&lt; :child.age. 15)) :children)}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   [:!_id :name :smallChildren.age {:new-salary (+ :salary 5)}]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   (sort-s :!new-salary))</span></div></div></div></div></div></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cover-mql"></a>Cover MQL<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cover-mql" title="Direct link to heading">#</a></h3><p>cMQL is made to cover MQL (MQL can be used raw inside cMQL also if we want)</p><ol><li>operators (<a href="/cmql-core/docs/#update-and-query-operators">see also</a>)  </li><li>stages</li><li>arguments</li><li>commands </li></ol><p>cMQL operators/stages/commands are part of the cMQL core and generate MQL operators/stages/commands.<br>
cMQL arguments are used with the driver methods and are more driver depended and part of cMQL-j or cMQL-js.   </p><p>Example using the Java driver and showing the alternatives
The example is very small,but still code becomes 2x less.</p><p>Java</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">zips.aggregate(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      asList(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        match(eq(&quot;state&quot;, &quot;TX&quot;)),</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        group(&quot;$city&quot;, sum(&quot;totalPop&quot;, &quot;$pop&quot;)),</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        project(fields(excludeId(),</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                       include(&quot;totalPop&quot;),</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                       computed(&quot;city&quot;, &quot;$_id&quot;))),</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        sort(descending(&quot;totalPop&quot;))));</span></div></div></div></div></div><p>Clojure interop</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">(.aggregate zips </span></div><div class="token-line" style="color:#393A34"><span class="token plain">            [(match (eq &quot;state&quot; &quot;TX&quot;))</span></div><div class="token-line" style="color:#393A34"><span class="token plain">             (group &quot;$city&quot; (sum &quot;totalPop&quot; &quot;$pop&quot;))</span></div><div class="token-line" style="color:#393A34"><span class="token plain">             (project (fields (excludeId)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                              (include &quot;totalPop&quot;)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">                              (computed &quot;city&quot; &quot;$_id&quot;)))</span></div><div class="token-line" style="color:#393A34"><span class="token plain">             (sort (descending &quot;totalPop&quot;))])</span></div></div></div></div></div><p>cMQL arguments (keep the driver method,but pipeline in cMQL)</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">(.aggregate zips</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            (p (= :state &quot;TX&quot;)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">               (group :city {:totalPop (sum :pop))</span></div><div class="token-line" style="color:#393A34"><span class="token plain">               [:!_id :totalPop]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">               (sort :!totalPop))) </span></div></div></div></div></div><p>cMQL wrap methods </p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">(q zips</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   (p (= :state &quot;TX&quot;)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      (group :city {:totalPop (sum :pop))</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      [:!_id :totalPop]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      (sort :!totalPop))) </span></div></div></div></div></div><p>cMQL command like call (portabillity between the drivers)</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">(q zips</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   (= :state &quot;TX&quot;)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   (group :city {:totalPop (sum :pop))</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   [:!_id :totalPop]</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   (sort :!totalPop)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   {:allowDiskUse true}) </span></div></div></div></div></div><p>cMQL is not intent to replace the driver or change the way the driver is used.
cMQL is made to make queries easier.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="update-and-query-operators"></a>Update and query operators<a aria-hidden="true" tabindex="-1" class="hash-link" href="#update-and-query-operators" title="Direct link to heading">#</a></h4><p>In MongoDB we have like 3 type of operators,query/update/aggregate.   </p><p>This is complex because</p><ul><li>they share names  </li><li>functionality   </li><li>they have different syntax  </li><li>we cant mix them (exception is the $exp that allows aggregate operators in find)<br>this is the main problem,for example i can try to do an update with update operator,
but i am bounded to use only update operators that are so limited.   </li></ul><p>To avoid this complexity cMQL tries to use 1 way,and do the querying and updates with the aggregation framework.   </p><ul><li>aggregate operators inside the $match stage with $exp<br>MongoDB 5 allows index use not only with $exp not only for $eq,<a href="https://docs.mongodb.com/v5.0/reference/operator/query/expr/#behavior" target="_blank" rel="noopener noreferrer">see v5 docs</a><br>So far to allow the use of index cMQL wraped some query operators,and if needed more can be wrapped.    </li><li>pipeline updates (cMQL makes pipelines easy)  </li><li>aggregation &quot;versions&quot; of query operators to replace them   </li></ul><p>If something cannot be done with the aggregation framework</p><ul><li>use raw MQL inside cMQL</li><li>or use the driver with update/query operator  </li><li>use javascript</li></ul><p>For example we can use raw MQL query operators inside cMQL   </p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-text codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">(q :testdb.testcoll</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   {&quot;$match&quot; {&quot;$or&quot; [{&quot;score&quot; {&quot;$gt&quot; 70 &quot;$lt&quot; 90}} {&quot;views&quot; {&quot;$gte&quot; 1000}}]}}</span></div><div class="token-line" style="color:#393A34"><span class="token plain">   (limit 1))</span></div></div></div></div></div><p>If an operator can&#x27;t be replaced from the aggregation framework,and its commonly used,
cMQL can change in the future to support that operator.  </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="easy-to-use-from-drivers"></a>Easy to use from drivers<a aria-hidden="true" tabindex="-1" class="hash-link" href="#easy-to-use-from-drivers" title="Direct link to heading">#</a></h3><p>MQL is using JSON to reach developers in different languages.<br>
cMQL is using clojure as a hosted language to reach developers in different languages.   </p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="clojures-interop"></a>Clojure&#x27;s Interop<a aria-hidden="true" tabindex="-1" class="hash-link" href="#clojures-interop" title="Direct link to heading">#</a></h4><p>cMQL as a clojure library uses clojure&#x27;s interop
Clojure is made from the start to be a hosted language and interop with the host
language is very easy</p><p>Clojure doesn&#x27;t just runs on the platform,each Clojure version is made for the specific
platform,for example Clojure collections are Java Collections also.  </p><p>Using Java/Js from Clojure is completly easy.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button tabindex="0" type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div class="prism-code language-text codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">For example </span></div><div class="token-line" style="color:#393A34"><span class="token plain">aggregate(acoll,apipeline);</span></div><div class="token-line" style="color:#393A34"><span class="token plain">Becomes</span></div><div class="token-line" style="color:#393A34"><span class="token plain">(.aggregate acol acoll apipeline)</span></div></div></div></div></div><p>The opposite calling Clojure </p><ul><li>Clojurescript
Clojurescript functions are javascript functions,so we simply call them</li><li>Clojure
if the Clojure programmer made us a Java class, we can call Clojure like a Java static method
if he didnt we need 1-2 lines of code to make the java wrapper,and then we call like a normal Java</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cmql-uses-the-driver-way"></a>cMQL uses the driver way<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cmql-uses-the-driver-way" title="Direct link to heading">#</a></h4><p>cMQL also &quot;respects&quot; the driver way, cMQL targets only the query part.<br>
It doesnt attempt to change the way we use the driver for example how we connect to the database etc<br>
Only exceptions are complicated things off the driver or very commonly used parts of the driver  </p><p>For example cMQL doesn&#x27;t support the wrap of driver methods even the query methods,but for aggregate
we wrap it with the q macro,because its so commonly used.   </p><p>The goal is Java/javascript programmers to continue to use the driver like they are used to do it,
even if they use cMQL</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cmql-is-not-embedded"></a>cMQL is not embedded<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cmql-is-not-embedded" title="Direct link to heading">#</a></h4><p>MongoDB tries to connect MQL with programming languages with JSON as bridge,allowing MQL to be embeded in their code.<br>
But MQL is not like Java or Javascript,its looks like clojure in JSON syntax.<br>
And programmers soon realize that MQL is a new different language.     </p><p>cMQL is not embedded,it can be used</p><ul><li>same project with a folder for the clojure code (leinigein,maven etc)</li><li>or as a dependency,for example queries installed in maven as a jar,and we use them from Java</li></ul><p>*exception is when the application is in Clojure/Clojurescript.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="run-in-many-drivers"></a>Run in many drivers<a aria-hidden="true" tabindex="-1" class="hash-link" href="#run-in-many-drivers" title="Direct link to heading">#</a></h3><p>cMQL targets all projects that cMQL can support.<br>
The vast majority of projects are in Javascript and Java and they write complex queries.    </p><p>cMQL-j  </p><ol><li><a href="/cmql-core/docs/cMQL-j/javaapp">Java projects</a><br>queries in cMQL,call from java  </li><li><a href="/cmql-core/docs/cMQL-j/clojureapp">Clojure projects</a>  </li></ol><p>cMQL-js  </p><ol><li><a href="/cmql-core/docs/cMQL-j/nodejsapp">Nodejs projects</a><br>queries in cMQL,call from js  </li><li><a href="/cmql-core/docs/cMQL-j/clojurescriptapp">ClojureScript projects</a>  </li></ol><p>For now only Java/Nodejs driver are supported.     </p><p>cMQL is code is build to make this easier  </p><ol><li>cMQL-core<br>Converts cMQL to MQL<br>Its driver independent,allows us to replace MQL with cMQL  <ul><li>Operators</li><li>Stages</li><li>Commands
Commands can be used with runCommand of driver,or cMQL<br>parts like pipelines can be used as arguments in driver methods  </li></ul></li><li>cMQL-j<br>Uses cMQL-core to convert cMQL to MQL<br>Adds driver specific code for example convert a MQL pipeline to a Java Arraylist</li><li>cMQL-js<br>Uses cMQL-core to convert cMQL to MQL
Adds driver specific code for example convert a MQL pipeline to a js array</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="portability"></a>Portability<a aria-hidden="true" tabindex="-1" class="hash-link" href="#portability" title="Direct link to heading">#</a></h3><p>  cMQL queries are the same in all drivers.   </p><p>  if cMQL commands are used code is exactly the same.<br>
if driver methods are used with cMQL arguements,code is almost exactly the same.  </p><p>  cMQL can act as a common query language for all the drivers it supports</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="perfomance"></a>Perfomance<a aria-hidden="true" tabindex="-1" class="hash-link" href="#perfomance" title="Direct link to heading">#</a></h3><p>For Java/JS the drivers provides the way to encode/decode
cMQL adds a way to encode/decode for clojure/clojurescript data structures also</p><p>Encode : driver data structures -&gt; BSON<br>
Decode : BSON -&gt; driver data structures</p><p>Encoding is auto detected,Clojure/Clojurescript data convert directly to BSON
Decoding we set one default for our commands/methods for example to return JS data,
and in each query we send we can say {:decode &quot;cljs&quot;} for example to return something
different from the default</p><p>This allows us to have usable Clojure data structures without the perfomance penalty
of BSON-&gt;JAVA-&gt;CLOJURE, <strong>cMQL goes BSON&lt;-&gt;Clojure directly</strong></p><p>Generating MQL from cMQL doesn&#x27;t have any perfomance cost,because queries are so small
data structures.  </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="replace-javascript"></a>Replace Javascript<a aria-hidden="true" tabindex="-1" class="hash-link" href="#replace-javascript" title="Direct link to heading">#</a></h3><p>cMQL can replace Javascript,or reduce the js code size,for server side code also with the use of   </p><ul><li>Clojurescript (server side triggers)</li><li>cMQL wrappers (for js functions)</li><li>Clojurescript like language (for js functions)</li></ul><p>For more <a href="/cmql-core/docs/javascript-clojurescript/javascript">see</a>  </p><p>This can unify all MongoDB development under 1 language   </p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="unify-mongodb-developement"></a>Unify MongoDB developement<a aria-hidden="true" tabindex="-1" class="hash-link" href="#unify-mongodb-developement" title="Direct link to heading">#</a></h3><p>cMQL can unify all MongoDB developement under 1 language.</p><ul><li>cMQL for queries</li><li>Clojurescript for Javascript</li><li>Clojure for the application</li></ul></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/cmql-core/docs/intro/guide"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â«  </div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/cmql-core/docs/intro/why"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">  Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-is-cmql" class="table-of-contents__link">What is cMQL</a></li><li><a href="#examples" class="table-of-contents__link">Examples</a><ul><li><a href="#example1" class="table-of-contents__link">Example1</a></li><li><a href="#example2" class="table-of-contents__link">Example2</a></li><li><a href="#example-3" class="table-of-contents__link">Example 3</a></li><li><a href="#example-4" class="table-of-contents__link">Example 4</a></li></ul></li><li><a href="#cmql-as-tool-to-generate-mql" class="table-of-contents__link">cMQL as tool to generate MQL</a><ul><li><a href="#manual" class="table-of-contents__link">Manual</a></li><li><a href="#auto" class="table-of-contents__link">Auto</a></li></ul></li><li><a href="#cmql-as-api" class="table-of-contents__link">cMQL as API</a><ul><li><a href="#java-programmers" class="table-of-contents__link">Java programmers</a></li><li><a href="#node-programmers" class="table-of-contents__link">Node programmers</a></li><li><a href="#clojure-programmers" class="table-of-contents__link">Clojure programmers</a></li><li><a href="#clojurescript-programmers" class="table-of-contents__link">ClojureScript programmers</a></li></ul></li><li><a href="#cmql-goals" class="table-of-contents__link">cMQL-goals</a><ul><li><a href="#simple" class="table-of-contents__link">Simple</a></li><li><a href="#cover-mql" class="table-of-contents__link">Cover MQL</a></li><li><a href="#easy-to-use-from-drivers" class="table-of-contents__link">Easy to use from drivers</a></li><li><a href="#run-in-many-drivers" class="table-of-contents__link">Run in many drivers</a></li><li><a href="#portability" class="table-of-contents__link">Portability</a></li><li><a href="#perfomance" class="table-of-contents__link">Perfomance</a></li><li><a href="#replace-javascript" class="table-of-contents__link">Replace Javascript</a></li><li><a href="#unify-mongodb-developement" class="table-of-contents__link">Unify MongoDB developement</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/cmql-core/docs/">What is cMQL?</a></li><li class="footer__item"><a class="footer__link-item" href="/cmql-core/docs/intro/why">Why cMQL?</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Contact</h4><ul class="footer__items"><li class="footer__item"><a href="https://discord.gg/zWDzp4B7Bf" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="/cmql-core/docs/tkaryadis@gmail.com">tkaryadis@gmail.com</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">GitHub</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/tkaryadis/cmql-core" target="_blank" rel="noopener noreferrer" class="footer__link-item">cMQL-core</a></li><li class="footer__item"><a href="https://github.com/tkaryadis/cmql-j" target="_blank" rel="noopener noreferrer" class="footer__link-item">cMQL-j</a></li><li class="footer__item"><a href="https://github.com/tkaryadis/cmql-js" target="_blank" rel="noopener noreferrer" class="footer__link-item">cMQL-js</a></li></ul></div></div><div class="text--center"><div>Copyright 2021 Takis Karyadis</div></div></div></footer></div>
<script src="/cmql-core/styles.feaccdac.js"></script>
<script src="/cmql-core/runtime~main.d60d5b06.js"></script>
<script src="/cmql-core/main.2edf4c6f.js"></script>
<script src="/cmql-core/1.0eaafbb4.js"></script>
<script src="/cmql-core/2.086bcdde.js"></script>
<script src="/cmql-core/52.fe66fd41.js"></script>
<script src="/cmql-core/53.91d632f3.js"></script>
<script src="/cmql-core/935f2afb.7c2f70d3.js"></script>
<script src="/cmql-core/17896441.d6ed6c30.js"></script>
<script src="/cmql-core/b9d06000.39d8f44e.js"></script>
</body>
</html>