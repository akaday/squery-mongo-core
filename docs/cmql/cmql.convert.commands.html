<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>cmql.convert.commands documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Cmql</span> <span class="project-version">0.1.0-SNAPSHOT</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cmql</span></div></div></li><li class="depth-2 branch"><a href="cmql.administration.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>administration</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>common</span></div></div></li><li class="depth-3"><a href="cmql.common.common.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>common</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>convert</span></div></div></li><li class="depth-3 branch current"><a href="cmql.convert.commands.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>commands</span></div></a></li><li class="depth-3 branch"><a href="cmql.convert.common.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>common</span></div></a></li><li class="depth-3 branch"><a href="cmql.convert.js-functions.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>js-functions</span></div></a></li><li class="depth-3 branch"><a href="cmql.convert.operators.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>operators</span></div></a></li><li class="depth-3"><a href="cmql.convert.stages.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>stages</span></div></a></li><li class="depth-2 branch"><a href="cmql.diagnostic.html"><div class="inner"><span class="tree" style="top: -176px;"><span class="top" style="height: 185px;"></span><span class="bottom"></span></span><span>diagnostic</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>operators</span></div></div></li><li class="depth-3 branch"><a href="cmql.operators.operators.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>operators</span></div></a></li><li class="depth-3 branch"><a href="cmql.operators.options.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>options</span></div></a></li><li class="depth-3"><a href="cmql.operators.stages.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>stages</span></div></a></li><li class="depth-2 branch"><a href="cmql.read-write.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>read-write</span></div></a></li><li class="depth-2 branch"><a href="cmql.roles.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>roles</span></div></a></li><li class="depth-2"><a href="cmql.users.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>users</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="cmql.convert.commands.html#var-add-stage.3F"><div class="inner"><span>add-stage?</span></div></a></li><li class="depth-1"><a href="cmql.convert.commands.html#var-args-.3Equery-updatePipeline-options"><div class="inner"><span>args-&gt;query-updatePipeline-options</span></div></a></li><li class="depth-1"><a href="cmql.convert.commands.html#var-cmql-filters-.3Ematch-stage"><div class="inner"><span>cmql-filters-&gt;match-stage</span></div></a></li><li class="depth-1"><a href="cmql.convert.commands.html#var-cmql-map-.3Emql-map"><div class="inner"><span>cmql-map-&gt;mql-map</span></div></a></li><li class="depth-1"><a href="cmql.convert.commands.html#var-cmql-pipeline-.3Emql-pipeline"><div class="inner"><span>cmql-pipeline-&gt;mql-pipeline</span></div></a></li><li class="depth-1"><a href="cmql.convert.commands.html#var-cmql-specific-options"><div class="inner"><span>cmql-specific-options</span></div></a></li><li class="depth-1"><a href="cmql.convert.commands.html#var-cmql-vector-.3Emql-vector"><div class="inner"><span>cmql-vector-&gt;mql-vector</span></div></a></li><li class="depth-1"><a href="cmql.convert.commands.html#var-command-keys"><div class="inner"><span>command-keys</span></div></a></li><li class="depth-1"><a href="cmql.convert.commands.html#var-command-option.3F"><div class="inner"><span>command-option?</span></div></a></li><li class="depth-1"><a href="cmql.convert.commands.html#var-get-pipeline-options"><div class="inner"><span>get-pipeline-options</span></div></a></li><li class="depth-1"><a href="cmql.convert.commands.html#var-project-field.3F"><div class="inner"><span>project-field?</span></div></a></li><li class="depth-1"><a href="cmql.convert.commands.html#var-project-stage.3F"><div class="inner"><span>project-stage?</span></div></a></li><li class="depth-1"><a href="cmql.convert.commands.html#var-qfilter-stage.3F"><div class="inner"><span>qfilter-stage?</span></div></a></li><li class="depth-1"><a href="cmql.convert.commands.html#var-seperate-bulk"><div class="inner"><span>seperate-bulk</span></div></a></li><li class="depth-1"><a href="cmql.convert.commands.html#var-split-db-namespace"><div class="inner"><span>split-db-namespace</span></div></a></li><li class="depth-1"><a href="cmql.convert.commands.html#var-stage-operator.3F"><div class="inner"><span>stage-operator?</span></div></a></li><li class="depth-1"><a href="cmql.convert.commands.html#var-stage-operators"><div class="inner"><span>stage-operators</span></div></a></li><li class="depth-1"><a href="cmql.convert.commands.html#var-update-pipeline-stage.3F"><div class="inner"><span>update-pipeline-stage?</span></div></a></li><li class="depth-1"><a href="cmql.convert.commands.html#var-upsert-query"><div class="inner"><span>upsert-query</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">cmql.convert.commands</h1><div class="doc"><pre class="plaintext"></pre></div><div class="public anchor" id="var-add-stage.3F"><h3>add-stage?</h3><div class="usage"><code>(add-stage? m)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-args-.3Equery-updatePipeline-options"><h3>args-&gt;query-updatePipeline-options</h3><div class="usage"><code>(args-&gt;query-updatePipeline-options args command-keys)</code></div><div class="doc"><pre class="plaintext">Seperates update arguments to [query update-pipeline options]
Its used from update command,and from others like delete(dq) , that dont have pipeline just query and options</pre></div></div><div class="public anchor" id="var-cmql-filters-.3Ematch-stage"><h3>cmql-filters-&gt;match-stage</h3><div class="usage"><code>(cmql-filters-&gt;match-stage filters qfilters?)</code></div><div class="doc"><pre class="plaintext">Many filters(aggregate operators) combined to a match $exprs using $and operators
</pre></div></div><div class="public anchor" id="var-cmql-map-.3Emql-map"><h3>cmql-map-&gt;mql-map</h3><div class="usage"><code>(cmql-map-&gt;mql-map m)</code></div><div class="doc"><pre class="plaintext">Converts a smongo query a valid mongo query (removes the smongo symbols)

Variables
  :aname-        =&gt;   '$$aname'
  :aname-.afield =&gt;   '$$aname.afield'
  :-            =&gt; anonymous variable converts to '$$__m__'

Keyword in key poistion =&gt; field name
  {:f ''}  =&gt; {'f' ''}

Keyword not in key position =&gt; field reference
  :v =&gt; '$v'   (can be as value in a map,a value in a vector,or out of a collection)

else
  no change
</pre></div></div><div class="public anchor" id="var-cmql-pipeline-.3Emql-pipeline"><h3>cmql-pipeline-&gt;mql-pipeline</h3><div class="usage"><code>(cmql-pipeline-&gt;mql-pipeline cmql-pipeline)</code></div><div class="doc"><pre class="plaintext">Converts a cmql-pipeline to a mongo pipeline (1 vector with members stage operators)
[],{}../nil  =&gt; empty stages or nil stages are removed
[[] []] =&gt; [] []   flatten of stages (used when one stage produces more than 1 stages)
cmql-filters combined =&gt;  $match stage with $and
[] projects  =&gt; $project</pre></div></div><div class="public anchor" id="var-cmql-specific-options"><h3>cmql-specific-options</h3><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-cmql-vector-.3Emql-vector"><h3>cmql-vector-&gt;mql-vector</h3><div class="usage"><code>(cmql-vector-&gt;mql-vector v)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-command-keys"><h3>command-keys</h3><div class="usage"><code>(command-keys command-def)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-command-option.3F"><h3>command-option?</h3><div class="usage"><code>(command-option? option command-keys)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-get-pipeline-options"><h3>get-pipeline-options</h3><div class="usage"><code>(get-pipeline-options args command-keys)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-project-field.3F"><h3>project-field?</h3><div class="usage"><code>(project-field? field)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-project-stage.3F"><h3>project-stage?</h3><div class="usage"><code>(project-stage? m)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-qfilter-stage.3F"><h3>qfilter-stage?</h3><div class="usage"><code>(qfilter-stage? stage)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-seperate-bulk"><h3>seperate-bulk</h3><div class="usage"><code>(seperate-bulk bulk-key args)</code></div><div class="doc"><pre class="plaintext">Used in bulk deletes/updates seperate the bulk queries from the args
({:dq ...} {:dq ...} arg1 arg2 ...) =&gt; [ [{:dq ...} {:dq ...}] [arg1 arg2 ...] ]</pre></div></div><div class="public anchor" id="var-split-db-namespace"><h3>split-db-namespace</h3><div class="usage"><code>(split-db-namespace db-namespace)</code></div><div class="doc"><pre class="plaintext">Arguments can be
:db-name.coll-name
:db-name
:.coll-name     ;;db-name will be '',the default db will be added later in the command
Seperator can be the . or /
</pre></div></div><div class="public anchor" id="var-stage-operator.3F"><h3>stage-operator?</h3><div class="usage"><code>(stage-operator? stage)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-stage-operators"><h3>stage-operators</h3><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-update-pipeline-stage.3F"><h3>update-pipeline-stage?</h3><div class="usage"><code>(update-pipeline-stage? stage)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-upsert-query"><h3>upsert-query</h3><div class="usage"><code>(upsert-query args)</code></div><div class="doc"><pre class="plaintext"></pre></div></div></div></body></html>