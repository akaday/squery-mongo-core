<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>cmql.read-write documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Cmql</span> <span class="project-version">0.1.0-SNAPSHOT</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cmql</span></div></div></li><li class="depth-2 branch"><a href="cmql.administration.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>administration</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>common</span></div></div></li><li class="depth-3"><a href="cmql.common.common.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>common</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>convert</span></div></div></li><li class="depth-3 branch"><a href="cmql.convert.commands.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>commands</span></div></a></li><li class="depth-3 branch"><a href="cmql.convert.common.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>common</span></div></a></li><li class="depth-3 branch"><a href="cmql.convert.js-functions.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>js-functions</span></div></a></li><li class="depth-3 branch"><a href="cmql.convert.operators.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>operators</span></div></a></li><li class="depth-3"><a href="cmql.convert.stages.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>stages</span></div></a></li><li class="depth-2 branch"><a href="cmql.diagnostic.html"><div class="inner"><span class="tree" style="top: -176px;"><span class="top" style="height: 185px;"></span><span class="bottom"></span></span><span>diagnostic</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>operators</span></div></div></li><li class="depth-3 branch"><a href="cmql.operators.operators.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>operators</span></div></a></li><li class="depth-3 branch"><a href="cmql.operators.options.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>options</span></div></a></li><li class="depth-3"><a href="cmql.operators.stages.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>stages</span></div></a></li><li class="depth-2 branch current"><a href="cmql.read-write.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>read-write</span></div></a></li><li class="depth-2 branch"><a href="cmql.roles.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>roles</span></div></a></li><li class="depth-2"><a href="cmql.users.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>users</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="cmql.read-write.html#var-aggregate-def"><div class="inner"><span>aggregate-def</span></div></a></li><li class="depth-1"><a href="cmql.read-write.html#var-count-def"><div class="inner"><span>count-def</span></div></a></li><li class="depth-1"><a href="cmql.read-write.html#var-delete"><div class="inner"><span>delete</span></div></a></li><li class="depth-1"><a href="cmql.read-write.html#var-delete-def"><div class="inner"><span>delete-def</span></div></a></li><li class="depth-1"><a href="cmql.read-write.html#var-distinct-def"><div class="inner"><span>distinct-def</span></div></a></li><li class="depth-1"><a href="cmql.read-write.html#var-dq-f"><div class="inner"><span>dq-f</span></div></a></li><li class="depth-1"><a href="cmql.read-write.html#var-find-and-modify-def"><div class="inner"><span>find-and-modify-def</span></div></a></li><li class="depth-1"><a href="cmql.read-write.html#var-find-and-modify-f"><div class="inner"><span>find-and-modify-f</span></div></a></li><li class="depth-1"><a href="cmql.read-write.html#var-find-def"><div class="inner"><span>find-def</span></div></a></li><li class="depth-1"><a href="cmql.read-write.html#var-fq-f"><div class="inner"><span>fq-f</span></div></a></li><li class="depth-1"><a href="cmql.read-write.html#var-insert"><div class="inner"><span>insert</span></div></a></li><li class="depth-1"><a href="cmql.read-write.html#var-insert-def"><div class="inner"><span>insert-def</span></div></a></li><li class="depth-1"><a href="cmql.read-write.html#var-q-count-f"><div class="inner"><span>q-count-f</span></div></a></li><li class="depth-1"><a href="cmql.read-write.html#var-q-distinct-f"><div class="inner"><span>q-distinct-f</span></div></a></li><li class="depth-1"><a href="cmql.read-write.html#var-q-f"><div class="inner"><span>q-f</span></div></a></li><li class="depth-1"><a href="cmql.read-write.html#var-update-"><div class="inner"><span>update-</span></div></a></li><li class="depth-1"><a href="cmql.read-write.html#var-update-def"><div class="inner"><span>update-def</span></div></a></li><li class="depth-1"><a href="cmql.read-write.html#var-uq-f"><div class="inner"><span>uq-f</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">cmql.read-write</h1><div class="doc"><pre class="plaintext"></pre></div><div class="public anchor" id="var-aggregate-def"><h3>aggregate-def</h3><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-count-def"><h3>count-def</h3><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-delete"><h3>delete</h3><div class="usage"><code>(delete db-namespace &amp; args)</code></div><div class="doc"><pre class="plaintext">Delete documents using one or more delete queries (dq ..)
Call
(delete :testdb.testcoll (dq ...) (dq ..) opt1 opt2 ...)
(delete :testdb.testcoll [(dq ...) (dq ..)] {:ordered true} ...)
Delete all matching is the default {:limit 0}</pre></div></div><div class="public anchor" id="var-delete-def"><h3>delete-def</h3><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-distinct-def"><h3>distinct-def</h3><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-dq-f"><h3>dq-f</h3><div class="usage"><code>(dq-f &amp; args)</code></div><div class="doc"><pre class="plaintext">Delete query,one delete command can take one or many dqs
Each dq will be a member of :deletes [],see delete command
Call
 (dq filter1 filter2)
 (dq (&gt;_ age 25) {:comment '...'})</pre></div></div><div class="public anchor" id="var-find-and-modify-def"><h3>find-and-modify-def</h3><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-find-and-modify-f"><h3>find-and-modify-f</h3><div class="usage"><code>(find-and-modify-f db-namespace &amp; args)</code></div><div class="doc"><pre class="plaintext">Find and Modify as one step
query/update/sort as if it was pipeline stages
The rest are options
If many match the first document is choosen
Call
Find-Modify (no upsert)
(find-and-modify :testdb.testcoll
                 (=_ :name 'MongoDB')
                 {:name (str- :name '-with-id=1')}
                 (sort- :_id)
                 (fields-o :!_id :name)
                 (new-o))

Upsert (when upsert true =&gt; first argument doc(only then))
(find-and-modify :testdb.testcoll
                 {:_id 4}
                 {:name (if- (exist?- :name)
                          (str- :name '-with-id=4')
                          'new-name')}
                 {:upsert true} ;; upsert =&gt; first argument document
                 (fields-o :!_id :name)
                 (new-o))</pre></div></div><div class="public anchor" id="var-find-def"><h3>find-def</h3><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-fq-f"><h3>fq-f</h3><div class="usage"><code>(fq-f db-namespace &amp; args)</code></div><div class="doc"><pre class="plaintext">Find query
filters/project/sort/skip/limit as if it was pipeline stages
(they are auto converted to find command options)
The rest are options
Call
(fq :testdb.testcoll
    (&gt;_ :spent 150)
    (sort- :!spent)
    [:!_id :spent {:aspent (+_ :spent 20)}]
    (skip 5)
    (limit 1)
    {:singleBatch true})</pre></div></div><div class="public anchor" id="var-insert"><h3>insert</h3><div class="usage"><code>(insert db-namespace documents &amp; args)</code></div><div class="doc"><pre class="plaintext">Call
(insert :testdb.testcoll doc option1 option2 ...)
(insert :testdb.testcoll [doc1 doc2 ...] option1 option2})</pre></div></div><div class="public anchor" id="var-insert-def"><h3>insert-def</h3><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-q-count-f"><h3>q-count-f</h3><div class="usage"><code>(q-count-f db-namespace &amp; args)</code></div><div class="doc"><pre class="plaintext">Count documents with optional query on them
Can be done with aggregation easily
query/limit/skip use as aggregate stages
Call
(q-count  :testdb.testcoll
          (= :dept 'A')      ; filters like aggregation
          (skip 1)
          (limit 1))</pre></div></div><div class="public anchor" id="var-q-distinct-f"><h3>q-distinct-f</h3><div class="usage"><code>(q-distinct-f db-namespace &amp; args)</code></div><div class="doc"><pre class="plaintext">Distinct a field,make it an array,with optinal query first
Can be done with aggregation easily
Call
(q-distinct :testdb.testcoll
            (not= :dept 'B')
            {:key 'dept'})</pre></div></div><div class="public anchor" id="var-q-f"><h3>q-f</h3><div class="usage"><code>(q-f db-namespace &amp; args)</code></div><div class="doc"><pre class="plaintext">()-&gt;filters {}-&gt;addfields []-&gt;project
Pipeline stages can be nil or nested

Call example
(q :testdb.testcoll
    (&gt;_ :age 25)
    (=_ :gender 'female')           ; filter, both will be 1 match stage with $and and $expr
    {:pass (&gt;_ :grade 5)}           ; addFields
    (group :hairColor               ; :hairColor :count  ,here :_id will be auto-replaced by :hairColor
           {:count (sum- 1)})
    [:count]                        ; project,keep only count
    (&gt;_ :count 20)                  ; another filter alone =&gt; 1 match stage
    (sort- :!count)                 ; sort descending
    (skip 2)
    (limit 1))</pre></div></div><div class="public anchor" id="var-update-"><h3>update-</h3><div class="usage"><code>(update- db-namespace &amp; args)</code></div><div class="doc"><pre class="plaintext">Update documents using one or more update queries uqs
Update many is the default {:limit 0}
Call
(update- :testdb.testcoll (uq ...) (uq ..) opt1 opt2 ...)
(update- :testdb.testcoll [(uq ...) (uq ..)] opt1 opt2 ...)</pre></div></div><div class="public anchor" id="var-update-def"><h3>update-def</h3><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-uq-f"><h3>uq-f</h3><div class="usage"><code>(uq-f &amp; args)</code></div><div class="doc"><pre class="plaintext">Update query,one update command can take one or many uqs
Each uq will be a member of :updates [].see update command
uq works only with pipeline updates
query is always filters,document is only when {:upsert true}
Call
(uq (=_ :_id 2)
    {:grade (+_ :grade 5)}
    [:!_id :name])

Upsert (if upsert true =&gt; document always as first argument)
(uq {:_id 4}
    {:grade (if- (exist?- :grade)
              (+_ :grade 5)
              10)}
    {:upsert true})</pre></div></div></div></body></html>